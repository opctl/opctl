description: deploys website to github pages
name: deploy
inputs:
  github:
    object:
      constraints:
        properties:
          accessToken:
            minLength: 1
            type: string
            writeOnly: true
          username:
            minLength: 1
            type: string
        required: [accessToken, username]
      description: configuration required to interact w/ github
  HOME:
    dir:
      description: Home directory of caller; used to access go modules
run:
  serial:
    - op:
        ref: $(../init)
        inputs:
          HOME:
    - container:
        cmd:
          - yarn
          - run
          - deploy
        dirs:
          /src: $(../../..)
        envVars:
          GIT_USER_NAME: $(github.username)
          GIT_USER_EMAIL: $(github.username)
          GIT_USER: $(github.username)
          GIT_PASS: $(github.accessToken)
        image: { ref: 'node:20' }
        workDir: /src/website
